$def with (connected, mail, logtable, letter, paving)
$var title : Affordable Pasteurizer
$if paving:
    <div id="paving" class="jumbotron" onclick="void(0);"></div>
    <script type="text/javascript">
       var here = $$("#paving");
       here.load("static/ecran_accueil.svg", function() {
       $for letter in menus.sysActions+menus.cleanActions+menus.dirtyActions:
            SVGready($$("#menu${letter}"));
       });
    </script>
$if not paving:
    <main role="main" class="container">
    <div class="jumbotron" onclick="void(0);">
    $if connected:
        <button onclick='fromHereTo("$(letter)","Z")' class="btn btn-danger" id="STOP" style="float:right">STOP</button>

        <h3><b id="time"></b> &nbsp; <b id="actionletter"></b>:<b id="action"></b> &nbsp; (<span id="emptied">$(ml.T("Circuit vidé","Emptied circuit","Leeg circuit")), </span><b id="stateletter" class="show-flow"></b>:<b id="state"></b>)<br/><span id="danger" class="danger"></span></h3>
        <p style="margin:auto"><span id="actiontitle"></span></p>
        <button onclick="action('>')" class="btn btn-success" id="forcing" style="float:right")>&gt;&gt;</button>
        <button onclick="action('S')" class="btn btn-warning" id="pause" style="float:right">$(ml.T("Pause","Pause","Pauze"))</button>
        <button onclick="action('!')" class="btn btn-info" id="buckbutton" style="float:right">$(ml.T("Seau fourni","Bucket provided","Emmer voorzien"))&nbsp;<span id="bucket" class="glyphicon"></span></button>
        <button onclick="action('+')" class="btn btn-info" id="addbutton" style="float:right">$(ml.T("Produit ajouté","Product added","Product toegevoegd"))&nbsp;<span id="added" class="glyphicon"></span></button>
        <!--button onclick="action('&gt;')" class="btn btn-info" id="force" style="float:right">$(ml.T("Forcer>","Force>","Kracht>"))</button-->
        <button onclick="action('_')" class="btn btn-success" id="restart" style="float:right">$(ml.T("Redémarrer","Restart","Herstart"))</button>
        <!--button onclick="action('V')" class="btn btn-warning" id="dumpbutton" style="float:right">$(ml.T("Vider","purge","zuiVering"))</button-->

        <p class="alert alert-warning" style="display:inline-block"><b id="accro"></b> <span id="message"></span><span id="delay"></span></p>
        <hr/>
    $if logtable:
        <script type="text/javascript">
                $$('#logtable').hide();
        </script>
        <a href="/"><button class="btn btn-info">$(ml.T("Retour au Schéma","Back to schema","Terug naar schema"))</button></a>
        <table id="tableau" class="display responsive compact hover" style="width:100%">
                <thead>
                <tr id="topHeader">
                    <th name="date">Heure</th>
                    <th>Watts</th>
                    <th>W/h</th>
                    <th>$(ml.T("Qtité","Qtity","Aantal"))</th>
                    <th>L/h</th>
                    <th>$(ml.T("Déb.Chaud","Heat.Beg","BeginVerw."))°</th>
                    <th>$(ml.T("Chauffe","Heating","Verwarm."))°</th>
                    <th>$(ml.T("Garantie","Guaranty","Garantie"))°</th>
                    <th>$(ml.T("Entrée","Input","Invoer"))°</th>
                    <!--th>(ml.T("Tempér","Mitig","Mitig"))°</th-->
                    <!--th>Extra°</th-->
                </tr>
                </thead>
                <tfoot>
                <tr id="bottomHeader">
                </tr>
                </tfoot>
        </table>
        <script type="text/javascript">
            $$('#bottomHeader').html($$('#topHeader').html());
        </script>
    $if not logtable:
        <table class="Pshape">
                <tr>
                    <td id="OUTbucket" rowspan="2"><span id="tbout"></span><br/><span id="qbout"></span></td>
                    <td colspan="5">&nbsp;</td>
                    <td class="Ushape" rowspan="4" id="Dheating"><div class="Oshape" id="Dwarranty"><div class="Drotate"><span class="glyphicon glyphicon-random show-flow"></span></div><span>&nbsp;<b id="warranty"></b>°&nbsp;</span></div><span>&nbsp;<b id="heating"></b>°&nbsp;</span></td>
                </tr>
                <tr>
                    <td class="Lshape" colspan="2"><span id="level2"><big><b style="color:red">X</b></big></span><small>&lt;$(ml.T("Sortie","Output","Uitvoer"))</small>&nbsp;<span class="glyphicon show-flow show-empty backward"></span></td>
                    <!--td class="Eshape"><b id="extra"></b></td-->
                    <td class="Eshape"><div><span class="glyphicon show-flow show-empty backward"></span></div><span id="rmeter"></span></td>
                    <!--td class="Ushape" rowspan="2"><b id="temper"></b>°</td-->
                    <!--td class="Eshape"><span class="glyphicon glyphicon-arrow-left"/></td-->
                    <!--td class="Bshape" rowspan="2"><span class="glyphicon glyphicon-random Drotate show-flow"/></td-->
                    <td class="OTshape greenToRed">&nbsp;<span class="glyphicon backward"></span>&nbsp;</td>
                    <td class="Eshape"><div style="display:inline"><span class="glyphicon show-flow show-empty backward"></span></div></td>
                </tr>
                <tr>
                    <td id="INbucket" valign="top" rowspan="2"><span id="tbin"></span><br/><span id="qbin"></span></td>
                    <td rowspan="2" valign="top"><span id="level1"><big><b style="color:blue">X</b></big></span><small>&gt;$(ml.T("Entrée","Input","Invoer"))</small>&nbsp;<span class="glyphicon show-flow show-empty forward"></span></td>
                    <td class="Oshape" rowspan="2"><b id="vitesse"></b>L/h</td>
                    <td class="Dshape" valign="top"><span class="glyphicon show-flow show-empty forward"></span></td>
                    <td class="OBshape greenToRed" valign="top">&nbsp;<span class="glyphicon forward"></span>&nbsp;</td>
                    <td class="Dshape" valign="top"><div style="display:inline"><span class="glyphicon show-flow show-empty forward"></span></div></td>
                </tr>
                <tr>
                    <td class="Dshape"><span id="Dintake">&nbsp;<b id="intake"></b>°&nbsp;</span><br/><span class="glyphicon glyphicon-log-in" id="fill" style="color:blue"></span></td>
                    <td>&nbsp;</td>
                    <td class="Dshape"><span id="Dinput">&nbsp;<b id="input"></b>°&nbsp;</span></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td valign="top" align="center"><!--span id="pressMin" font-color="blue"></span>&nbsp;&lt;&nbsp;<b id="press"></b>&nbsp;&lt;&nbsp;<span id="pressMax" font-color="red"></span>bar<br/-->&sum;=<b id="volume"></b>L<br/><span id="remain"></span></td>
                    <!--td align="right" colspan="2"><span class="nobreak"><div style="display:inline;"><span class="glyphicon glyphicon-fire"/></div><b id="watts2"></b>W/h</span></td-->
                    <td>&nbsp;</td>
                    <td align="center" colspan="2">&sum;=<b id="totalwatt"></b>W</td>
                    <td align="right"><span class="nobreak"><div style="display:inline;"><span class="glyphicon glyphicon-fire"></span></div><b id="watts"></b>W/h</span></td>
                </tr>
                <tr>
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="center"><i id="pumpopt"></i><i>L/h</i></td>
                    <td>&nbsp;</td>
                    <!--td align="center"><span id="cooling"><i id="opt_T"></i><i>°</i></span> <span id="cleaning"><i id="opt_tempbis"></i><i>°</i></span></td-->
                    <td align="right" colspan="4"><i id="opt_temp"></i><i>°, </i><i id="opt_M"></i><i>"</i></td>
                </tr>
                <tr id="eff">
                    <td>&nbsp;</td>
                    <td>&nbsp;</td>
                    <td align="center" style="text-decoration:overline"><i id="pumpeff"></i><i>L/h</i></td>
                    <td>&nbsp;</td>
                    <!--td align="center"><span id="cooling"><i id="opt_T"></i><i>°</i></span> <span id="cleaning"><i id="opt_tempbis"></i><i>°</i></span></td-->
                    <td align="right" colspan="4"><i id="heateff"></i><i>%</i></td>
                </tr>
        </table>
    $if connected and letter:
            <hr/>
            <a name="doc"></a>
            <ul id="documentation">
            $if letter == 'F':
              $if ml.lang == 'f':
                <li>Votre pasteurisateur contient des restes de produit, de détergent ou de désinfectant...
                <li>On utilise soit l’eau potable du réseau ou celle d'un seau.
                <li>Pour l'eau du réseau: mettez le tuyau d’entrée et le tuyau de sortie dans un même seau ou au dessus d'un égout.
                <li>Pour l'eau d'un seau, mettez le tuyau d’entrée dans celui-ci et le tuyau de sortie dans un autre.
                <li>Faîtes attention à ce que les seaux fassent au moins 20L si vous faites 4 rinçages.
                <li>L’eau de rinçage peut être récupérée pour une autre fois: elle sert alors pour les deux premiers rinçages parmi 4.
              $if ml.lang == 'e':
                §Your pasteuriser contains product, detergent or disinfectant residues...
                §You can use either mains water or water coming from a bucket.
                §For mains water: put the inlet and outlet pipes in the same bucket or over a drain.
                §For bucket water, put the inlet pipe in the bucket and the outlet pipe in another bucket.
                §Make sure the buckets are at least 20L if you are doing 4 rinses.
                §The rinse water can be collected for another time: it is then used for the first two rinses out of 4.
              $if ml.lang == 'n':
                §Uw pasteur bevat resten product, reinigingsmiddel of ontsmettingsmiddel...
                §Je gebruikt leidingwater of water uit een emmer.
                §Voor leidingwater: leg de in- en uitlaatleidingen in dezelfde emmer of boven een afvoer.
                §Voor emmer water: stop de inlaatpijp in deze en de uitlaatpijp in een andere.
                §Zorg ervoor dat de emmers minstens 20 liter groot zijn als u 4 keer spoelt.
                §Het spoelwater kan worden opgevangen voor een andere keer: het wordt dan gebruikt voor de eerste twee van de 4 spoelingen.
            $if letter == 'P':
              $if ml.lang == 'f':
                <li>La pasteurisation prend le lait crû (ou autre boisson) et le chauffe le temps requis (configurable entre 15 et 30 secondes) à la température requise (configurable entre 60 et 89°C).
                <li>Nettoyer l'extérieur du tuyau d’entrée puis le mettre dans le bidon de lait crû (ou autre boisson).
                <li>Le tuyau de sortie fournira d'abord l'eau contenue dans le pasteurisateur (5 litres). Il y aura ensuite une pause pour que vous puissiez le brancher à la cuve de sortie lorsque le lait arrive.
                <li>Cette cuve devra être impeccablement vide, propre et désinfectée.
                <li>Le bouton vert permet de reprendre. Le bouton jaune permet de faire une pause (par exemple, pour passer d'un bidon de lait crû au suivant).
                <li>Lorsque tous les bidons d'entrée ont été aspirés, la commande "E"(Pousse-à-l'eau) prendra 5L d’eau propre d'un bidon d’entrée pour pousser le lait qui reste vers la sortie du circuit.
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == "I":
              $if ml.lang == 'f':
                <li>Si une panne électrique ou une autre cause interrompt la pasteurisation, il faut reprendre le traitement dès que possible...
                <li>Garder le tuyau d’entrée dans le bidon de lait crû (ou autre boisson) et le tuyau de sortie branché à la cuve de sortie.
                <li>La pasteurisation reprend alors directement.
                <li>Le bouton vert permet de reprendre. Le bouton jaune permet de faire une pause (par exemple, pour passer d'un bidon de lait crû au suivant).
                <li>Lorsque tous les bidons d'entrée ont été aspirés, la commande "E"(Pousse-à-l'eau) prendra 5L d’eau propre d'un bidon d’entrée pour pousser le lait qui reste vers la sortie du circuit.
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == 'E':
              $if ml.lang == 'f':
                <li>Quand il n’y a plus de lait crû dans le bidon d’entrée, il faut encore chasser le lait qui reste dans la machine. De l’eau est nécessaire et la machine arrête juste à temps pour ne pas la mettre dans le tampon de sortie...</li>
                <li>Détacher les tuyaux d’entrée et de sortie (bien enfoncer la bague du « push-in » et retirer l’embout qui y était inséré)
                <li>Mettre le tuyau d’entrée dans le bidon de lait crû et utiliser le tuyau de sortie avec la pince de Mohr pour embouteiller.
                <li>Mettez au préalable 4L d’eau propre dans le bidon d’entrée.
                <li>La pompe sera automatiquement arrêtée quand assez d’eau aura été pompée pour chasser tout le lait restant dans la machine.
                <li>Un bouton jaune permet de faire une pause (puis de reprendre). Un bouton rouge permet d’arrêter totalement.
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == 'M':
              $if ml.lang == 'f':
                <li>Quand on change les paramètres de chauffe (par exemple, passer du Yaourt au Lait à embouteiller), il faut en terminer avec le lait qui a été traité selon un premier jeu de consignes
                    (temps configurable entre 15 et 30 secondes; température configurable entre 60 et 89°C).).
                    On met déjà le nouvau lait (ou mélange) en entrée et la machine arrête juste à temps pour d'abord changer la consigne de pasteurisation si désiré
                    et, une deuxième fois, pour changer le récipient de sortie...</li>
                <li>Détacher les tuyaux d’entrée et de sortie (bien enfoncer la bague du « push-in » et retirer l’embout qui y était inséré)
                <li>Mettre le tuyau d’entrée dans le bidon de lait crû et utiliser le tuyau de sortie avec la pince de Mohr pour embouteiller.
                <li>Mettez au préalable le nouveau lait/mélange en entrée.
                <li>La pompe sera automatiquement arrêtée une première fois quand assez aura été pompé pour amener le nouveau lait/mélange à la pasteurisation: vous pourrez alors changer la consigne de température si désiré.
                <li>La pompe sera automatiquement arrêtée une seconde fois quand assez aura été pompé pour chasser tout le lait restant dans la machine (et que le lait/mélange suivant commence à arriver).
                <li>Un bouton jaune permet de faire une pause (puis de reprendre). Un bouton rouge permet d’arrêter totalement.
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == 'R':
              $if ml.lang == 'f':
                <li>Votre pasteurisateur a été utilisé et il est sale...
                <li>Branchez (« push-in ») le tuyau d’entrée à la hauteur de la soupape d’entrée d’air et le tuyau de sortie à la hauteur de la vanne d’égout.
                <li>Faîtes attention que le tuyau d’égout arrive dans un seau d’au moins 20L.
                <li>Un « Flush » d’eau chaude sanitaire (45°C) est effectué au préalable.
                <li>L’eau de rinçage est cyclée 3 minutes à 45°C.
                <li>V : l’eau est vidée vers l’égout en fin de cycle (environ 5L).
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == 'C':
              $if ml.lang == 'f':
                <li>Votre pasteurisateur a été rincé sommairement mais il faut le nettoyer en profondeur.
                <li>Branchez (« push-in ») le tuyau d’entrée à la hauteur de la soupape d’entrée d’air et le tuyau de sortie à la hauteur de la vanne d’égout.
                <li>Faîtes attention que le tuyau d’égout arrive dans un seau d’au moins 20L.
                <li>Un remplissage d’eau chaude sanitaire (45°C) est effectué au préalable.
                <li>Vous pourrez y mettre un détergent (caustique) pour NEP (CIP) dilué dans le tampon de sortie selon les instructions du fabricant du détergent.
                <li>Tenez compte du niveau d’eau (graduations en Litres sur le tampon) et de l’eau dans le pasteurisateur (3.5L) pour calculer les quantités nécessaires.
                <li>Le détergent ainsi dilué est circulé 15 minutes à 45°C.
                <li>Il est vidé vers l’égout en fin de cycle (environ 5L).
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == 'A':
              $if ml.lang == 'f':
                <li>Votre pasteurisateur a été nettoyé mais il faut encore le désinfecter.
                <li>Branchez (« push-in ») le tuyau d’entrée à la hauteur de la soupape d’entrée d’air et le tuyau de sortie à la hauteur de la vanne d’égout.
                <li>Faîtes attention que le tuyau d’égout arrive dans un seau d’au moins 20L.
                <li>Un remplissage d’eau chaude sanitaire (45°C) est effectué au préalable pour obtenir l’eau nécessaire.
                <li>Vous pourrez y mettre un désinfectant (acide ou caustique) pour NEP (CIP) dilué dans le tampon de sortie selon les instructions du fabricant du désinfectant.
                <li>Tenez compte du niveau d’eau (graduations en Litres sur le tampon) et de l’eau dans le pasteurisateur (3.5L) pour calculer les quantités nécessaires.
                <li>Le désinfectant ainsi dilué est circulé 5 minutes à 55°C.
                <li>Il est vidé vers l’égout en fin de cycle (environ 5L).
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            $if letter == 'D':
              $if ml.lang == 'f':
                <li>Votre pasteurisateur a été nettoyé mais il faut encore le désinfecter.
                <li>Branchez (« push-in ») le tuyau d’entrée à la hauteur de la soupape d’entrée d’air et le tuyau de sortie à la hauteur de la vanne d’égout.
                <li>Faîtes attention que le tuyau d’égout arrive dans un seau d’au moins 20L.
                <li>Un remplissage d’eau chaude sanitaire (45°C) est effectué au préalable pour obtenir l’eau nécessaire.
                <li>Vous pourrez y mettre un désinfectant (acide ou caustique) pour NEP (CIP) dilué dans le tampon de sortie selon les instructions du fabricant du désinfectant.
                <li>Tenez compte du niveau d’eau (graduations en Litres sur le tampon) et de l’eau dans le pasteurisateur (3.5L) pour calculer les quantités nécessaires.
                <li>Le désinfectant ainsi dilué est circulé 5 minutes à 55°C.
                <li>Il est vidé vers l’égout en fin de cycle (environ 5L).
              $if ml.lang == 'e':
                <li>&nbsp;</li>
            </ul>
            <p class="alert alert-warning">$(menus.actionName[letter][2])</p>
            <a class="btn btn-success" href="#" onclick="action('$letter')" id="confirm">$(ml.T("Confirmer","Confirm","Bevestigen")) $letter: $(menus.actionName[letter][1]) - $(menus.actionName[letter][3])</a>
            <a class="btn btn-warning" href="/" id="cancel">$(ml.T("Annuler","Cancel","Annuleer"))</a>
    $if not connected :
        <div>
            <h4>$(ml.T("Cette application gère votre pasteurisateur accessible","This app manages your affordable flow pasteuriser","Deze app beheert uw betaalbare continu pasteurisator")).</h4>
            <h1>$(ml.T("Veuillez vous identifier S.V.P","Please identify yourself","Identificeer u alstublieft"))</h1>

            <form class="form-inline" method="post" action="/" id="loginForm" data-bv-message="This value is not valid"  data-bv-live="enabled" data-bv-container="tooltip"data-bv-submitButtons="#loginSubmit">
                <input type="hidden" name="erroruri" value=""/>
                <div class="form-group">
                    <input type="email" name="mail" placeholder="Email" class="form-control" size="20" autofocus/>
                </div>
                <div class="form-group">
                    <input type="password" name="password" placeholder="Password" class="form-control" size="8"/>
                </div>
                <span class="sr-only">Log in</span>
                <span class="totip" data-toggle="tooltip" data-placement="bottom" title="log-IN" style="pointer-events: auto;">
                    <input type="hidden" name="method" id="method" value="login">
                    <button type="submit" name="login" class="btn btn-warning" id="loginSubmit">
                        <span class="glyphicon glyphicon-user"></span>
                        <span class="glyphicon glyphicon-log-in"></span>
                    </button>
                </span>
            </form>
            $code:
               result = subprocess.check_output(['ip','-4', '-o','addr'])
               result = result.decode('utf-8').split('\n')
               toDisplay = ""
               for line in result:
                   line = line.split('scope')[0].split('brd')[0].strip()
                   toDisplay += line+'<br>'
            <pre>$:toDisplay</pre>
        </div>
    </div>
    </main>

